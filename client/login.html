<!DOCTYPE html>
<html>
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>User Login</title>
   </head>
<body>
  <h1>Login</h1>
  <form id="login-form">
    <label for="usernameOrEmail">Username or Email:</label>
    <!--username or email input with autocomplete attributes-->
    <input type="text" id="usernameOrEmail" required>
    <br>
    <label for="password">Password:</label>
    <input type="password" id="password" required>
    <br>
    <input type="submit" value="Login">
  </form>
  <script src="https://cdn.jsdelivr.net/npm/bcryptjs/dist/bcrypt.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
   const form = document.getElementById('login-form');
   form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const usernameOrEmail = form.elements.usernameOrEmail.value;
        const password = form.elements.password.value;

      await fetch('http://localhost:5556/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ usernameOrEmail, password })
      })
         .then(response => response.json())
         .then(json => {
            if (json.success) {
               alert('Login successful!');
               localStorage.setItem('token', json.cookie);
               window.location.href = '/index.html';
            } else {
               alert(json.message.toString());
               throw new Error(json.message.toString());
            }
         })
         .catch(error => {
            console.error(error);
            alert('Login failed! ' + error);
         });
      });
  </script>
  
</body>
</html>
